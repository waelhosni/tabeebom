import React,{useState,useRef,useCallback,useEffect,memo}from"react";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _extends(){return(_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function _objectWithoutPropertiesLoose(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}function _objectWithoutProperties(e,r){if(null==e)return{};var t,n,o=_objectWithoutPropertiesLoose(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],n=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(t.push(s.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return t}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var observerErr="ðŸ’¡react-cool-img: the browser doesn't support Intersection Observer, please install polyfill to enable lazy loading: https://github.com/wellyshen/react-cool-img#intersection-observer-polyfill",thresholdWarn="ðŸ’¡react-cool-img: the threshold of observerOptions must be a number. Use 0 as fallback.",useObserver=function(e,r){var t=r.root,n=r.rootMargin,o=void 0===n?"50px":n,i=r.threshold,s=void 0===i?.01:i,a=_slicedToArray(useState(!1),2),c=a[0],l=a[1],u=_slicedToArray(useState(null),2),f=u[0],d=u[1],m=useRef(null),y=useRef(null),h=useRef(!1),g=s;"number"!=typeof s&&(console.warn(thresholdWarn),g=0);var b=useCallback((function(){y.current&&(clearTimeout(y.current),y.current=null)}),[]);return useEffect((function(){if(!("IntersectionObserver"in window)||!("IntersectionObserverEntry"in window))return h.current||(console.error(observerErr),h.current=!0),l(!0),function(){return null};m.current=new IntersectionObserver((function(r){var t=_slicedToArray(r,1)[0],n=t.isIntersecting,o=t.intersectionRatio;(void 0!==n?n:o>0)&&!c?y.current=setTimeout((function(){l(!0)}),e):b()}),{root:t,rootMargin:o,threshold:g});var r=m.current;return f&&r.observe(f),function(){r.disconnect(),b()}}),[f,c,t,o,g,e,b]),[d,c]},key="REACT_COOL_IMG",set=function(e){try{var r=JSON.parse(sessionStorage.getItem(key)||"{}");r[e]=new Date,sessionStorage.setItem(key,JSON.stringify(r))}catch(e){console.error("ðŸ’¡react-cool-img: ".concat(e))}},get=function(e){try{return!!JSON.parse(sessionStorage.getItem(key)||"{}")[e]}catch(e){return console.error("ðŸ’¡react-cool-img: ".concat(e)),!1}},Imager=function(){function e(){_classCallCheck(this,e),_defineProperty(this,"img",null),_defineProperty(this,"timeout",null),_defineProperty(this,"retries",1)}return _createClass(e,[{key:"load",value:function(e,r,t,n,o,i){var s=this,a=t.count,c=void 0===a?3:a,l=t.delay,u=void 0===l?2:l,f=t.acc,d=void 0===f?"*":f;this.img=new Image,this.img.src=e,i&&(this.img.crossOrigin=i),r&&this.img.decode&&this.img.decode().catch((function(){})),this.img.onerror=function(r){if(!c||s.retries>c)n(r);else{var t="*"===d?Math.pow(u,s.retries):u*s.retries;!1===d&&(t=u),s.timeout=setTimeout((function(){s.clearImgSrc(),s.img.src=e}),1e3*t),s.retries+=1}},this.img.onload=function(e){o(e)}}},{key:"unload",value:function(){this.img&&(this.img.onerror=null,this.img.onload=null,this.clearImgSrc(),this.img=null),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.retries=1}},{key:"clearImgSrc",value:function(){this.img.src="";try{delete this.img.src}catch(e){}}}]),e}(),Img=function(e){var r=e.className,t=void 0===r?"":r,n=e.placeholder,o=e.src,i=e.error,s=e.crossOrigin,a=e.decode,c=void 0===a||a,l=e.lazy,u=void 0===l||l,f=e.cache,d=void 0===f||f,m=e.debounce,y=void 0===m?300:m,h=e.observerOptions,g=void 0===h?{}:h,b=e.retry,p=void 0===b?{}:b,v=e.srcSet,A=e.sizes,_=e.onError,O=e.onLoad,I=_objectWithoutProperties(e,["className","placeholder","src","error","crossOrigin","decode","lazy","cache","debounce","observerOptions","retry","srcSet","sizes","onError","onLoad"]),w=useRef(new Imager),S=_slicedToArray(useObserver(y,g),2),E=S[0],T=S[1],j=_slicedToArray(useState(n||"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="),2),R=j[0],k=j[1],P=R===o,C=o?o.replace(/^.*[\\/]/,"").split(".")[0]:"",x=function(e){_&&_(e),i?k(i):n&&k(n)},L=function(e){O&&O(e),k(o),d&&set(o)};return useEffect((function(){var e=w.current,r=function(){e.load(o,c,p,x,L,s)};return(!u||d&&get(o)||T)&&r(),function(){e.unload()}}),[d,T,o,s,c,p]),React.createElement(React.Fragment,null,React.createElement("img",_extends({className:"".concat(t," no-js-").concat(C),src:R,crossOrigin:P?s:void 0,srcSet:P?v:void 0,sizes:P?A:void 0,ref:E},I)),React.createElement("noscript",null,React.createElement("style",null,".no-js-".concat(C," { display: none !important; }")),React.createElement("img",_extends({className:t,src:o,crossOrigin:s,srcSet:v,sizes:A},I))))},index=memo(Img);export default index;
