"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=r(e);function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function i(){return(i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function c(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function a(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],n=!0,o=!1,i=void 0;try{for(var c,a=e[Symbol.iterator]();!(n=(c=a.next()).done)&&(t.push(c.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return t}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return s(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return s(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var l="REACT_COOL_IMG",u=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"img",null),o(this,"timeout",null),o(this,"retries",1)}var r,t,i;return r=e,(t=[{key:"load",value:function(e,r,t,n,o,i){var c=this,a=t.count,s=void 0===a?3:a,l=t.delay,u=void 0===l?2:l,f=t.acc,m=void 0===f?"*":f;this.img=new Image,this.img.src=e,i&&(this.img.crossOrigin=i),r&&this.img.decode&&this.img.decode().catch((function(){})),this.img.onerror=function(r){if(!s||c.retries>s)n(r);else{var t="*"===m?Math.pow(u,c.retries):u*c.retries;!1===m&&(t=u),c.timeout=setTimeout((function(){c.clearImgSrc(),c.img.src=e}),1e3*t),c.retries+=1}},this.img.onload=function(e){o(e)}}},{key:"unload",value:function(){this.img&&(this.img.onerror=null,this.img.onload=null,this.clearImgSrc(),this.img=null),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.retries=1}},{key:"clearImgSrc",value:function(){this.img.src="";try{delete this.img.src}catch(e){}}}])&&n(r.prototype,t),i&&n(r,i),e}(),f=function(r){var n=r.className,o=void 0===n?"":n,s=r.placeholder,f=r.src,m=r.error,d=r.crossOrigin,g=r.decode,h=void 0===g||g,v=r.lazy,y=void 0===v||v,b=r.cache,p=void 0===b||b,O=r.debounce,A=void 0===O?300:O,w=r.observerOptions,S=void 0===w?{}:w,I=r.retry,E=void 0===I?{}:I,j=r.srcSet,R=r.sizes,k=r.onError,z=r.onLoad,C=c(r,["className","placeholder","src","error","crossOrigin","decode","lazy","cache","debounce","observerOptions","retry","srcSet","sizes","onError","onLoad"]),N=e.useRef(new u),P=function(r,t){var n=t.root,o=t.rootMargin,i=void 0===o?"50px":o,c=t.threshold,s=void 0===c?.01:c,l=a(e.useState(!1),2),u=l[0],f=l[1],m=a(e.useState(null),2),d=m[0],g=m[1],h=e.useRef(null),v=e.useRef(null),y=e.useRef(!1),b=s;"number"!=typeof s&&(console.warn("ðŸ’¡react-cool-img: the threshold of observerOptions must be a number. Use 0 as fallback."),b=0);var p=e.useCallback((function(){v.current&&(clearTimeout(v.current),v.current=null)}),[]);return e.useEffect((function(){if(!("IntersectionObserver"in window)||!("IntersectionObserverEntry"in window))return y.current||(console.error("ðŸ’¡react-cool-img: the browser doesn't support Intersection Observer, please install polyfill to enable lazy loading: https://github.com/wellyshen/react-cool-img#intersection-observer-polyfill"),y.current=!0),f(!0),function(){return null};h.current=new IntersectionObserver((function(e){var t=a(e,1)[0],n=t.isIntersecting,o=t.intersectionRatio;(void 0!==n?n:o>0)&&!u?v.current=setTimeout((function(){f(!0)}),r):p()}),{root:n,rootMargin:i,threshold:b});var e=h.current;return d&&e.observe(d),function(){e.disconnect(),p()}}),[d,u,n,i,b,r,p]),[g,u]}(A,S),T=a(P,2),x=T[0],M=T[1],L=a(e.useState(s||"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="),2),_=L[0],B=L[1],J=_===f,D=f?f.replace(/^.*[\\/]/,"").split(".")[0]:"",G=function(e){k&&k(e),m?B(m):s&&B(s)},U=function(e){z&&z(e),B(f),p&&function(e){try{var r=JSON.parse(sessionStorage.getItem(l)||"{}");r[e]=new Date,sessionStorage.setItem(l,JSON.stringify(r))}catch(e){console.error("ðŸ’¡react-cool-img: ".concat(e))}}(f)};return e.useEffect((function(){var e=N.current,r=function(){e.load(f,h,E,G,U,d)};return(!y||p&&function(e){try{return!!JSON.parse(sessionStorage.getItem(l)||"{}")[e]}catch(e){return console.error("ðŸ’¡react-cool-img: ".concat(e)),!1}}(f)||M)&&r(),function(){e.unload()}}),[p,M,f,d,h,E]),t.default.createElement(t.default.Fragment,null,t.default.createElement("img",i({className:"".concat(o," no-js-").concat(D),src:_,crossOrigin:J?d:void 0,srcSet:J?j:void 0,sizes:J?R:void 0,ref:x},C)),t.default.createElement("noscript",null,t.default.createElement("style",null,".no-js-".concat(D," { display: none !important; }")),t.default.createElement("img",i({className:o,src:f,crossOrigin:d,srcSet:j,sizes:R},C))))},m=e.memo(f);exports.default=m;
